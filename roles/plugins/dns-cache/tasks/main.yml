- name: Create dns-cache directory
  file:
    path: /etc/kubernetes/plugins/dns-cache
    state: directory

- name: Get ClusterIP of kube-dns
  shell: "{{ bin_dir }}/kubectl get svc -n kube-system | grep kube-dns | grep -v upstream | awk '{ print $3 }'"
  register: kube_dns_clusterip

- include_tasks: disable.yml
  when: enable_dns_cache == 'disable'

- include_tasks: enable.yml
  when: 
  - enable_dns_cache == 'enable'
  - component_option == 'cluster-create'

- include_tasks: disable.yml
  when: 
  - enable_dns_cache == 'enable' 
  - component_option != 'default'

- include_tasks: enable.yml
  when: 
  - enable_dns_cache == 'enable' 
  - component_option != 'default'